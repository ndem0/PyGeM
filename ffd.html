

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Free-form Deformation &mdash; PyGeM 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Radial Basis Function" href="rbf.html" />
    <link rel="prev" title="Code Documentation" href="code.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PyGeM
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="code.html">Code Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Free-form Deformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbf.html">Radial Basis Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbf_factory.html">RBF Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="idw.html">Inverse Distance Weighting</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_deformation.html">Custom Deformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="filehandler.html">Filehandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="vtkhandler.html">Vtkhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="stlhandler.html">Stlhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="openfhandler.html">Openfhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="unvhandler.html">Unvhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="code.html#cad">CAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="code.html#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyGeM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="code.html">Code Documentation</a> &raquo;</li>
        
      <li>Free-form Deformation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ffd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-pygem.ffd">
<span id="free-form-deformation"></span><h1>Free-form Deformation<a class="headerlink" href="#module-pygem.ffd" title="Permalink to this headline">¶</a></h1>
<p>Utilities for performing Free Form Deformation (FFD).</p>
<dl class="field-list">
<dt class="field-odd">Theoretical Insight</dt>
<dd class="field-odd"><p>Free Form Deformation is a technique for the efficient, smooth and accurate
geometrical parametrization. It has been proposed the first time in
<em>Sederberg, Thomas W., and Scott R. Parry. “Free-form deformation of solid
geometric models.” ACM SIGGRAPH computer graphics 20.4 (1986): 151-160</em>. It
consists in three different step:</p>
<ul class="simple">
<li><p>Mapping the physical domain to the reference one with map
<span class="math">\boldsymbol{\psi}</span>.  In the code it is named <em>transformation</em>.</p></li>
<li><p>Moving some control points to deform the lattice with <span class="math">\hat{T}</span>.
The movement of the control points is basically the weight (or
displacement) <span class="math">\boldsymbol{\mu}</span> we set in the <em>parameters file</em>.</p></li>
<li><p>Mapping back to the physical domain with map
<span class="math">\boldsymbol{\psi}^{-1}</span>.  In the code it is named
<em>inverse_transformation</em>.</p></li>
</ul>
<p>FFD map (<span class="math">T</span>) is the composition of the three maps, that is</p>
<div class="math">
<p><span class="math">T(\cdot, \boldsymbol{\mu}) = (\Psi^{-1} \circ \hat{T} \circ
\Psi) (\cdot, \boldsymbol{\mu})</span></p>
</div><p>In this way, every point inside the FFD box changes it position according to</p>
<div class="math">
<p><span class="math">\boldsymbol{P} = \boldsymbol{\psi}^{-1} \left( \sum_{l=0}^L
\sum_{m=0}^M \sum_{n=0}^N
\mathsf{b}_{lmn}(\boldsymbol{\psi}(\boldsymbol{P}_0))
\boldsymbol{\mu}_{lmn} \right)</span></p>
</div><p>where <span class="math">\mathsf{b}_{lmn}</span> are Bernstein polynomials.  We improve the
traditional version by allowing a rotation of the FFD lattice in order to
give more flexibility to the tool.</p>
<p>You can try to add more shapes to the lattice to allow more and more
involved transformations.</p>
</dd>
</dl>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
</tbody>
</table>
<dl class="py class">
<dt>
<em class="property">class </em><code class="sig-name descname">FFD</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">n_control_points</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">pygem.deformation.Deformation</span></code></p>
<p>Class that handles the Free Form Deformation on the mesh points.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>n_control_points</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – number of control points in the x, y, and z
direction. Default is [2, 2, 2].</p>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>box_length</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – dimension of the FFD bounding box, in the
x, y and z direction (local coordinate system).</p></li>
<li><p><strong>box_origin</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – the x, y and z coordinates of the origin of
the FFD bounding box.</p></li>
<li><p><strong>rot_angle</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – rotation angle around x, y and z axis of the
FFD bounding box.</p></li>
<li><p><strong>n_control_points</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – the number of control points in the
x, y, and z direction.</p></li>
<li><p><strong>array_mu_x</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – collects the displacements (weights) along
x, normalized with the box length x.</p></li>
<li><p><strong>array_mu_y</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – collects the displacements (weights) along
y, normalized with the box length y.</p></li>
<li><p><strong>array_mu_z</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – collects the displacements (weights) along
z, normalized with the box length z.</p></li>
</ul>
</dd>
<dt class="field-odd">Example</dt>
<dd class="field-odd"><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pygem</span> <span class="kn">import</span> <span class="n">FFD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffd</span> <span class="o">=</span> <span class="n">FFD</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffd</span><span class="o">.</span><span class="n">read_parameters</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="s1">&#39;tests/test_datasets/parameters_test_ffd_sphere.prm&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">original_mesh_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;tests/test_datasets/meshpoints_sphere_orig.npy&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_mesh_points</span> <span class="o">=</span> <span class="n">ffd</span><span class="p">(</span><span class="n">original_mesh_points</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="py method">
<dt>
<em class="property">property </em><code class="sig-name descname">n_control_points</code></dt>
<dd><p>The number of control points in X, Y and Z directions</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<em class="property">property </em><code class="sig-name descname">psi</code></dt>
<dd><p>Return the function that map the physical domain to the reference
domain.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>callable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<em class="property">property </em><code class="sig-name descname">inverse_psi</code></dt>
<dd><p>Return the function that map the reference domain to the physical
domain.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>callable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<em class="property">property </em><code class="sig-name descname">T</code></dt>
<dd><p>Return the function that deforms the points within the unit cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>callable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<em class="property">property </em><code class="sig-name descname">rotation_matrix</code></dt>
<dd><p>The rotation matrix (according to rot_angle_x, rot_angle_y,
rot_angle_z).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<em class="property">property </em><code class="sig-name descname">position_vertices</code></dt>
<dd><p>The position of the vertices of the FFD bounding box.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<code class="sig-name descname">reset_weights</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD.reset_weights"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Set transformation parameters to arrays of zeros.</p>
</dd></dl>

<dl class="py method">
<dt>
<code class="sig-name descname">read_parameters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span><span class="o">=</span><span class="default_value">'parameters.prm'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD.read_parameters"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Reads in the parameters file and fill the self structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>string</em>) – parameters file to be read in.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<code class="sig-name descname">write_parameters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span><span class="o">=</span><span class="default_value">'parameters.prm'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD.write_parameters"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This method writes a parameters file (.prm) called <cite>filename</cite> and fills
it with all the parameters class members.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>string</em>) – parameters file to be written out.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<code class="sig-name descname">control_points</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">deformed</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD.control_points"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Method that returns the FFD control points. If the <cite>deformed</cite> flag is
set to True the method returns the deformed lattice, otherwise it
returns the original undeformed lattice.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>deformed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – flag to select the original or modified FFD
control lattice. The default is True.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the FFD control points (by row).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<code class="sig-name descname">reflect</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">axis</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD.reflect"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Reflect the lattice of control points along the direction defined
by <cite>axis</cite>. In particular the origin point of the lattice is preserved.
So, for instance, the reflection along x, is made with respect to the
face of the lattice in the yz plane that is opposite to the origin.
Same for the other directions. Only the weights (mu) along the chosen
axis are reflected, while the others are preserved. The symmetry plane
can not present deformations along the chosen axis.
After the refletcion there will be 2n-1 control points along <cite>axis</cite>,
witha doubled box length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>axis</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – axis along which the reflection is performed.
Default is 0. Possible values are 0, 1, or 2, corresponding
to x, y, and z respectively.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt>
<code class="sig-name descname">__call__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src_pts</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/ffd.html#FFD.__call__"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This method performs the FFD to <cite>src_pts</cite> and return the deformed
points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>src_pts</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.18)"><em>numpy.ndarray</em></a>) – the array of dimensions (<em>n_points</em>, <em>3</em>)
containing the points to deform. The points have to be arranged by
row.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the deformed points</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray (with shape = (<em>n_points</em>, <em>3</em>))</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rbf.html" class="btn btn-neutral float-right" title="Radial Basis Function" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="code.html" class="btn btn-neutral float-left" title="Code Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright 2017-2020, PyGeM contributors
      <span class="lastupdated">
        Last updated on Jun 10, 2020.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>